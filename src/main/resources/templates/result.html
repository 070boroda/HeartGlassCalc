<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á—ë—Ç–∞</title>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg,#667eea,#764ba2);
            padding: 30px;
            min-height: 100vh;
        }

        .container {
            background:white;
            padding:30px;
            border-radius:20px;
            max-width:1200px;
            margin:auto;
            box-shadow:0 20px 60px rgba(0,0,0,0.3);
        }

        h1 { margin:0 0 10px 0; color:#222; }
        .sub { color:#666; margin-bottom:20px; }

        .banner {
            padding:12px 14px;
            border-radius:12px;
            margin: 12px 0 18px 0;
            font-weight:700;
            display:flex;
            justify-content:space-between;
            flex-wrap:wrap;
            gap:10px;
            align-items:center;
        }
        .ok { background:#e8f5e9; border:1px solid #c8e6c9; color:#1b5e20; }
        .bad { background:#ffebee; border:1px solid #ffcdd2; color:#b71c1c; }

        .grid {
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
            gap:12px;
            margin-top:10px;
        }

        .card {
            border:1px solid #e5e5e5;
            border-radius:14px;
            padding:14px 14px;
            background:#fff;
            box-shadow:0 4px 14px rgba(0,0,0,0.06);
        }
        .label { font-size:12px; color:#666; text-transform:uppercase; letter-spacing:0.5px; }
        .value { font-size:22px; font-weight:800; margin-top:6px; color:#222; }
        .unit  { font-size:12px; color:#888; margin-top:4px; }

        .svg-wrap {
            margin-top:22px;
            background:linear-gradient(135deg,#f5f7fa,#e9ecef);
            border-radius:16px;
            padding:16px;
            box-shadow:0 10px 30px rgba(0,0,0,0.12);
        }

        .svg-container {
            background:white;
            border:3px solid #4CAF50;
            border-radius:14px;
            padding:10px;
            max-height:650px;
            overflow:auto;
        }

        .buttons {
            margin-top:18px;
            display:flex;
            gap:14px;
            flex-wrap:wrap;
        }

        .btn {
            padding:12px 18px;
            border:none;
            border-radius:10px;
            font-weight:800;
            cursor:pointer;
            color:white;
            display:inline-flex;
            gap:8px;
            align-items:center;
            box-shadow:0 8px 18px rgba(0,0,0,0.18);
            text-decoration:none;
        }
        .btn:hover { transform: translateY(-1px); }

        .btn-svg { background: linear-gradient(135deg,#1976D2,#0D47A1); }
        .btn-dxf { background: linear-gradient(135deg,#FF9800,#E65100); }
        .btn-pdf { background: linear-gradient(135deg,#9C27B0,#6A1B9A); }
        .btn-back{ background: linear-gradient(135deg,#607D8B,#37474F); }

        .small {
            font-size:12px;
            color:#777;
            margin-top:10px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>–†–µ–∑—É–ª—å—Ç–∞—Ç –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ (MANUAL)</h1>
    <div class="sub">–†–µ–∂–∏–º: –≤—Ä—É—á–Ω—É—é –∑–∞–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ç (a / gap) ‚Üí —Ä–∞—Å—á—ë—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –º–æ—â–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è.</div>

    <div th:class="${T(java.lang.Math).abs(result.powerDeviationPercent) <= 10} ? 'banner ok' : 'banner bad'">
        <div>
            –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç —Ü–µ–ª–∏:
            <span th:text="${#numbers.formatDecimal(result.powerDeviationPercent,1,1)}"></span> %
        </div>
        <div>
            –¶–µ–ª—å: <span th:text="${#numbers.formatDecimal(result.targetPower,1,0)}"></span> –í—Ç/–º¬≤ ‚Üí
            –§–∞–∫—Ç: <span th:text="${#numbers.formatDecimal(result.achievedPowerWm2,1,1)}"></span> –í—Ç/–º¬≤
        </div>
    </div>

    <div class="grid">
        <div class="card">
            <div class="label">–†–∞–∑–º–µ—Ä —Å—Ç–µ–∫–ª–∞</div>
            <div class="value">
                <span th:text="${#numbers.formatDecimal(result.width,1,0)}"></span> √ó
                <span th:text="${#numbers.formatDecimal(result.height,1,0)}"></span>
            </div>
            <div class="unit">–º–º</div>
        </div>

        <div class="card">
            <div class="label">–ü–ª–æ—Å–∫–æ—Å—Ç–Ω–æ–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ</div>
            <div class="value" th:text="${#numbers.formatDecimal(result.sheetResistance,1,2)}"></div>
            <div class="unit">–û–º/‚ñ°</div>
        </div>

        <div class="card">
            <div class="label">R_target (–Ω—É–∂–Ω–æ–µ)</div>
            <div class="value" th:text="${#numbers.formatDecimal(result.totalResistance,1,2)}"></div>
            <div class="unit">–û–º</div>
        </div>

        <div class="card">
            <div class="label">R_raw (–±–µ–∑ —Ä–∏—Å—É–Ω–∫–∞)</div>
            <div class="value" th:text="${#numbers.formatDecimal(result.rawResistance,1,2)}"></div>
            <div class="unit">–û–º</div>
        </div>

        <div class="card">
            <div class="label">Multiplier (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π)</div>
            <div class="value" th:text="${#numbers.formatDecimal(result.pathLengthMultiplier,1,2)}"></div>
            <div class="unit">—Ä–∞–∑</div>
        </div>

        <div class="card">
            <div class="label">R_achieved (–¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ)</div>
            <div class="value" th:text="${#numbers.formatDecimal(result.achievedResistance,1,2)}"></div>
            <div class="unit">–û–º</div>
        </div>

        <div class="card">
            <div class="label">–°–æ—Ç–∞: —Å—Ç–æ—Ä–æ–Ω–∞ a</div>
            <div class="value" th:text="${#numbers.formatDecimal(result.hexSide,1,1)}"></div>
            <div class="unit">–º–º</div>
        </div>

        <div class="card">
            <div class="label">–°–æ—Ç–∞: –∑–∞–∑–æ—Ä gap</div>
            <div class="value" th:text="${#numbers.formatDecimal(result.hexGap,1,1)}"></div>
            <div class="unit">–º–º</div>
        </div>

        <div class="card">
            <div class="label">–û—Ç—Å—Ç—É–ø –æ—Ç –∫—Ä–∞—è</div>
            <div class="value" th:text="${#numbers.formatDecimal(result.edgeOffset,1,1)}"></div>
            <div class="unit">–º–º</div>
        </div>

        <div class="card">
            <div class="label">–û—Ç—Å—Ç—É–ø –æ—Ç —à–∏–Ω—ã</div>
            <div class="value" th:text="${#numbers.formatDecimal(result.busbarClearanceMm,1,1)}"></div>
            <div class="unit">–º–º</div>
        </div>

        <div class="card">
            <div class="label">–®–∏—Ä–∏–Ω–∞ —à–∏–Ω—ã</div>
            <div class="value" th:text="${#numbers.formatDecimal(result.busbarWidth,1,1)}"></div>
            <div class="unit">–º–º</div>
        </div>
        <!-- –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ (–µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–æ R_fact) -->
        <div class="card" th:if="${result.measuredResistance != null && result.measuredResistance > 0}">
            <div class="label">R_fact (–∏–∑–º–µ—Ä–µ–Ω–Ω–æ–µ)</div>
            <div class="value" th:text="${#numbers.formatDecimal(result.measuredResistance,1,2)}"></div>
            <div class="unit">–û–º</div>
        </div>

        <div class="card" th:if="${result.recommendedMultiplierScale != null}">
            <div class="label">–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π multiplier.scale</div>
            <div class="value" th:text="${#numbers.formatDecimal(result.recommendedMultiplierScale,1,3)}"></div>
            <div class="unit">–≤—Å—Ç–∞–≤–∏—Ç—å –≤ application.properties</div>
        </div>

        <div class="card" th:if="${result.calibrationErrorPercent != null}">
            <div class="label">–û—à–∏–±–∫–∞ –º–æ–¥–µ–ª–∏ (R_calc vs R_fact)</div>
            <div class="value" th:text="${#numbers.formatDecimal(result.calibrationErrorPercent,1,1)}"></div>
            <div class="unit">%</div>
        </div>


        <div class="card">
            <div class="label">–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è —à–∏–Ω</div>
            <div class="value"
                 th:text="${result.busbarOrientation == 2} ? '–°–ª–µ–≤–∞/—Å–ø—Ä–∞–≤–∞' : '–°–≤–µ—Ä—Ö—É/—Å–Ω–∏–∑—É'">
                –°–≤–µ—Ä—Ö—É/—Å–Ω–∏–∑—É
            </div>
            <div class="unit">&nbsp;</div>
        </div>
    </div>

    <div class="svg-wrap">
        <h2 style="margin:0 0 12px 0;">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∏—Å—É–Ω–∫–∞ (SVG)</h2>
        <div class="svg-container" th:utext="${svg}">
            SVG –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –±—É–¥–µ—Ç –∑–¥–µ—Å—å
        </div>
        <div class="small">
            * SVG ‚Äî —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è. DXF –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞.
        </div>
    </div>

    <div class="buttons">

        <!-- –°–∫–∞—á–∞—Ç—å SVG -->
        <form action="/download/svg" method="post">
            <input type="hidden" name="width" th:value="${result.width}">
            <input type="hidden" name="height" th:value="${result.height}">
            <input type="hidden" name="targetPower" th:value="${result.targetPower}">
            <input type="hidden" name="sheetResistance" th:value="${result.sheetResistance}">
            <input type="hidden" name="edgeOffset" th:value="${result.edgeOffset}">
            <input type="hidden" name="busbarWidth" th:value="${result.busbarWidth}">
            <input type="hidden" name="busbarOrientation" th:value="${result.busbarOrientation}">
            <input type="hidden" name="patternType" value="2">
            <input type="hidden" name="hexSide" th:value="${result.hexSide}">
            <input type="hidden" name="hexGap" th:value="${result.hexGap}">
            <input type="hidden" name="busbarClearanceMm" th:value="${result.busbarClearanceMm}">
            <input type="hidden" name="measuredResistance" th:value="${result.measuredResistance}">
            <button type="submit" class="btn btn-svg">üìä –°–∫–∞—á–∞—Ç—å SVG</button>
        </form>

        <!-- –°–∫–∞—á–∞—Ç—å DXF -->
        <form action="/download/dxf" method="post">
            <input type="hidden" name="width" th:value="${result.width}">
            <input type="hidden" name="height" th:value="${result.height}">
            <input type="hidden" name="targetPower" th:value="${result.targetPower}">
            <input type="hidden" name="sheetResistance" th:value="${result.sheetResistance}">
            <input type="hidden" name="edgeOffset" th:value="${result.edgeOffset}">
            <input type="hidden" name="busbarWidth" th:value="${result.busbarWidth}">
            <input type="hidden" name="busbarOrientation" th:value="${result.busbarOrientation}">
            <input type="hidden" name="patternType" value="2">
            <input type="hidden" name="hexSide" th:value="${result.hexSide}">
            <input type="hidden" name="hexGap" th:value="${result.hexGap}">
            <input type="hidden" name="busbarClearanceMm" th:value="${result.busbarClearanceMm}">
            <input type="hidden" name="measuredResistance" th:value="${result.measuredResistance}">
            <button type="submit" class="btn btn-dxf">‚öôÔ∏è –°–∫–∞—á–∞—Ç—å DXF</button>
        </form>

        <!-- PDF –æ—Ç—á—ë—Ç -->
        <form action="/report/pdf" method="post">
            <input type="hidden" name="width" th:value="${result.width}">
            <input type="hidden" name="height" th:value="${result.height}">
            <input type="hidden" name="targetPower" th:value="${result.targetPower}">
            <input type="hidden" name="sheetResistance" th:value="${result.sheetResistance}">
            <input type="hidden" name="edgeOffset" th:value="${result.edgeOffset}">
            <input type="hidden" name="busbarWidth" th:value="${result.busbarWidth}">
            <input type="hidden" name="busbarOrientation" th:value="${result.busbarOrientation}">
            <input type="hidden" name="patternType" value="2">
            <input type="hidden" name="hexSide" th:value="${result.hexSide}">
            <input type="hidden" name="hexGap" th:value="${result.hexGap}">
            <input type="hidden" name="busbarClearanceMm" th:value="${result.busbarClearanceMm}">
            <input type="hidden" name="measuredResistance" th:value="${result.measuredResistance}">
            <button type="submit" class="btn btn-pdf">üßæ –°–∫–∞—á–∞—Ç—å PDF –æ—Ç—á—ë—Ç</button>
        </form>

        <a class="btn btn-back" href="/">‚Üê –ù–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç</a>
    </div>
</div>

</body>
</html>
